

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Introduction &#8212; My Jupyter Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-2 bd-sidebar site-navigation show" id="site-navigation">
    
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Prepare_csv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Prepare_csv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            
        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>Uproot tutorial: https://masonproffitt.github.io/uproot-tutorial/aio.html</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># The wierd zero problem is fixed with uproot4: https://github.com/scikit-hep/uproot/issues/513</span>
<span class="c1"># Therefore, we don&#39;t need to use uproot3</span>
<span class="kn">import</span> <span class="nn">uproot4</span>
<span class="kn">import</span> <span class="nn">uproot</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>

<span class="c1"># First XGBoost model for Pima Indians dataset</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">loadtxt</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span><span class="n">roc_auc_score</span><span class="p">,</span><span class="n">auc</span> <span class="c1">#算auc用</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>[7, 8, 7, 4, 3, 2, 6, 3, 8, 4]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="validation-on-the-random">
<h1>Validation on the random<a class="headerlink" href="#validation-on-the-random" title="Permalink to this headline">¶</a></h1>
<p>random integer with step: https://stackoverflow.com/questions/3996904/generate-random-integers-between-0-and-9
count occurance of elements in array: https://stackoverflow.com/questions/21866625/counting-occurrences-of-items-in-an-array-python</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">140000</span><span class="p">))</span>
<span class="c1"># print(a)</span>
<span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Column1&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">})</span>

<span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

<span class="n">HiggsMassList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">700</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">900</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1100</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">1100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">1200</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;i = &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot; occurance = &quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
         <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;midnightblue&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
<span class="c1"># plt.hist(dataframe.mH,bins=np.linspace(400,1000,7),</span>
<span class="c1">#          histtype=&#39;step&#39;,color=&#39;firebrick&#39;,label=&#39;background&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;mH [GeV]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;mH [GeV]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>i =  300  occurance =  0
i =  400  occurance =  19596
i =  500  occurance =  19826
i =  600  occurance =  20117
i =  700  occurance =  20231
i =  800  occurance =  19966
i =  900  occurance =  20049
i =  1000  occurance =  20215
i =  1100  occurance =  0
</pre></div>
</div>
<img alt="_images/Prepare_csv_4_1.png" src="_images/Prepare_csv_4_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># fname = &quot;/lustre/umt3/user/metsai/hbsm4top/Offline/SM4t-212830_HBSM4tops_newBDT_syst_offv4_official/mc16a/2lss3lge1mv2c10j/4tops.root&quot;</span>
<span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;/lustre/umt3/user/metsai/hbsm4top/Offline/SM4t-212830_HBSM4tops_newBDT_syst_offv4_official/mc16a/2lss3lge1mv2c10j/vh.root&quot;</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">uproot</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="s2">&quot;nominal_Loose&quot;</span><span class="p">]</span>
<span class="n">EventID</span> <span class="o">=</span> <span class="n">uproot4</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="s2">&quot;nominal_Loose&quot;</span><span class="p">]</span>

<span class="c1"># Event ID</span>
<span class="n">runNumber_arr</span> <span class="o">=</span> <span class="n">EventID</span><span class="p">[</span><span class="s2">&quot;runNumber&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s2">&quot;pd&quot;</span><span class="p">)</span>
<span class="n">mcChannelNumber_arr</span> <span class="o">=</span> <span class="n">EventID</span><span class="p">[</span><span class="s2">&quot;mcChannelNumber&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s2">&quot;pd&quot;</span><span class="p">)</span>
<span class="n">eventNumber_arr</span> <span class="o">=</span> <span class="n">EventID</span><span class="p">[</span><span class="s2">&quot;eventNumber&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s2">&quot;pd&quot;</span><span class="p">)</span>

<span class="n">AllVariables</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;nJets&#39;</span><span class="p">,</span>
            <span class="s1">&#39;nBTags_MV2c10_77&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mmm_Zveto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;emm_Zveto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;eem_Zveto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;eee_Zveto&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SSmm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SSem_passECIDS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SSee_passECIDS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_normalise&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_mcweight_normalise&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_pileup&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_jvt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mc_generator_weights&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_bTagSF_MV2c10_Continuous_CDI20190730&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_indiv_SF_EL_ChargeID&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_mc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;weight_leptonSF&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isSignalBkg&#39;</span>
            <span class="p">]</span>

<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;met_met&#39;</span><span class="p">,</span><span class="s1">&#39;HT_all&#39;</span><span class="p">,</span><span class="s1">&#39;deltaR_ll_sum&#39;</span><span class="p">,</span><span class="s1">&#39;deltaR_ll_min&#39;</span><span class="p">,</span><span class="s1">&#39;SphericityJets&#39;</span><span class="p">,</span><span class="s1">&#39;SphericityXYJets&#39;</span><span class="p">]</span>
<span class="n">VariablesList</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">VariablesList</span><span class="p">)):</span>
    <span class="n">AllVariables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">VariablesList</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="p">);</span>

<span class="n">dataframe</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">pandas</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="n">AllVariables</span><span class="p">,</span><span class="n">flatten</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;runNumber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runNumber_arr</span>
<span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;mcChannelNumber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mcChannelNumber_arr</span>
<span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;eventNumber&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eventNumber_arr</span>
<span class="c1"># print(dataframe)</span>

<span class="c1"># combine the weights into one and then we can drop all nesty weights</span>
<span class="c1"># dataframe[&#39;weight&#39;] = (36207.7*(dataframe.runNumber==284500)+44307.4*(dataframe.runNumber==300000)+(dataframe.runNumber==310000)*58450.1)*(1/138965.16)*dataframe.weight_normalise*dataframe.weight_mcweight_normalise.str[85]/dataframe.weight_mcweight_normalise.str[0]*dataframe.weight_pileup*dataframe.weight_jvt*dataframe.mc_generator_weights.str[85]*dataframe.weight_leptonSF*dataframe.weight_bTagSF_MV2c10_Continuous_CDI20190730*(dataframe.weight_indiv_SF_EL_ChargeID*(dataframe.SSee_passECIDS | dataframe.SSem_passECIDS)+1*(~(dataframe.SSee_passECIDS.astype(bool) | dataframe.SSem_passECIDS.astype(bool))).astype(int))</span>
<span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">36207.7</span><span class="o">*</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">runNumber</span><span class="o">==</span><span class="mi">284500</span><span class="p">)</span><span class="o">+</span><span class="mf">44307.4</span><span class="o">*</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">runNumber</span><span class="o">==</span><span class="mi">300000</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">runNumber</span><span class="o">==</span><span class="mi">310000</span><span class="p">)</span><span class="o">*</span><span class="mf">58450.1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">138965.16</span><span class="p">)</span><span class="o">*</span><span class="n">dataframe</span><span class="o">.</span><span class="n">weight_normalise</span><span class="o">*</span><span class="n">dataframe</span><span class="o">.</span><span class="n">weight_pileup</span><span class="o">*</span><span class="n">dataframe</span><span class="o">.</span><span class="n">weight_jvt</span><span class="o">*</span><span class="n">dataframe</span><span class="o">.</span><span class="n">weight_mc</span><span class="o">*</span><span class="n">dataframe</span><span class="o">.</span><span class="n">weight_leptonSF</span><span class="o">*</span><span class="n">dataframe</span><span class="o">.</span><span class="n">weight_bTagSF_MV2c10_Continuous_CDI20190730</span><span class="o">*</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">weight_indiv_SF_EL_ChargeID</span><span class="o">*</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">SSee_passECIDS</span> <span class="o">|</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">SSem_passECIDS</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">SSee_passECIDS</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span> <span class="o">|</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">SSem_passECIDS</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

<span class="c1"># See reference: https://stackoverflow.com/questions/30327417/pandas-create-new-column-in-df-with-random-integers-from-range</span>
<span class="c1"># Randomly assign Higgs masses for non-BSM 4tops samples</span>
<span class="n">HiggsMassList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">700</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">900</span><span class="p">,</span><span class="mi">1000</span><span class="p">]</span>

<span class="n">mH_randomArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">randrange</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">1100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mH_randomArray</span>

<span class="c1"># Insert the correct Higgs masses for BSM 4tops samples</span>
<span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mcChannelNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">312440</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mcChannelNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">312441</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mcChannelNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">312442</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mcChannelNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">312443</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mcChannelNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">312444</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mcChannelNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">312445</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">900</span>
<span class="n">dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;mcChannelNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">312446</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;mH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
<span class="c1"># Drop the variables for the nesty weights</span>
<span class="c1"># WeightVariables = [ &#39;weight_normalise&#39;,</span>
<span class="c1">#                     &#39;weight_mcweight_normalise&#39;,</span>
<span class="c1">#                     &#39;weight_pileup&#39;,</span>
<span class="c1">#                     &#39;weight_jvt&#39;,</span>
<span class="c1">#                     &#39;mc_generator_weights&#39;,</span>
<span class="c1">#                     &#39;weight_bTagSF_MV2c10_Continuous_CDI20190730&#39;,</span>
<span class="c1">#                     &#39;weight_indiv_SF_EL_ChargeID&#39;,</span>
<span class="c1">#                     &#39;weight_mc&#39;,</span>
<span class="c1">#                     &#39;weight_leptonSF&#39;]</span>
<span class="c1"># dataframe = dataframe.drop(columns=WeightVariables)</span>


<span class="c1"># # Apply the selections (two-fold validation, even and odd)</span>
<span class="c1"># # See the intro: https://pandas.pydata.org/pandas-docs/stable/getting_started/intro_tutorials/03_subset_data.html</span>
<span class="c1"># Presel_df = Preselection(dataframe)</span>

<span class="c1"># # After preselection</span>
<span class="c1"># Variables=[&#39;nJets&#39;,&#39;nBTags_MV2c10_77&#39;,&#39;mmm_Zveto&#39;,&#39;emm_Zveto&#39;,&#39;eem_Zveto&#39;,&#39;eee_Zveto&#39;,&#39;SSmm&#39;,&#39;SSem_passECIDS&#39;,&#39;SSee_passECIDS&#39;,&#39;runNumber&#39;]</span>
<span class="c1"># Presel_df = Presel_df.drop(columns=Variables)</span>
<span class="c1"># # https://stackoverflow.com/questions/25649429/how-to-swap-two-dataframe-columns</span>
<span class="c1"># DefaultVar = [&#39;eventNumber&#39;, &#39;isSignalBkg&#39;, &#39;weight&#39;, &#39;mH&#39;, &#39;mcChannelNumber&#39;]</span>
<span class="c1"># for var in range(len(DefaultVar)):</span>
<span class="c1">#     VariablesList.append( DefaultVar[var] );</span>
<span class="c1"># Presel_df=Presel_df.reindex(columns=VariablesList)</span>

<span class="c1"># # print(&quot;Presel_df = \n\n&quot;, Presel_df)</span>

<span class="c1"># # outputfolder = args.outputfolder</span>
<span class="c1"># # outputfile = args.outputfile</span>
<span class="c1"># # Presel_df.to_csv(outputfolder+outputfile)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>       nJets  nBTags_MV2c10_77  mmm_Zveto  emm_Zveto  eem_Zveto  eee_Zveto  \
entry                                                                        
0          2                 1          0          0          0          0   
1          1                 1          0          0          0          0   
2          2                 1          0          0          0          0   
3          1                 1          0          0          0          0   
4          1                 1          0          0          0          0   
5          1                 1          0          0          0          0   
6          4                 1          0          0          0          0   
7          1                 1          0          0          0          0   
8          2                 1          0          0          0          0   
9          1                 1          0          0          0          0   
10         1                 1          0          0          0          0   
11         1                 1          0          0          0          0   
12         2                 2          0          0          0          0   
13         5                 2          0          0          0          0   
14         2                 1          0          0          0          0   
15         2                 1          0          0          0          0   
16         3                 1          0          0          0          0   
17         1                 1          0          0          0          0   
18         2                 1          0          0          0          0   
19         2                 1          0          0          0          0   
20         2                 1          0          0          0          0   

       SSmm  SSem_passECIDS  SSee_passECIDS  weight_normalise  \
entry                                                           
0         0               1               0          0.000014   
1         0               1               0          0.000014   
2         0               0               1          0.000014   
3         0               1               0          0.000014   
4         1               0               0          0.000014   
5         0               1               0          0.000014   
6         0               1               0          0.000014   
7         0               1               0          0.000014   
8         0               1               0          0.000014   
9         1               0               0          0.000014   
10        0               0               1          0.000014   
11        0               1               0          0.000014   
12        0               1               0          0.000009   
13        0               0               0          0.000009   
14        0               0               0          0.000009   
15        0               0               0          0.000009   
16        0               1               0          0.000009   
17        0               0               0          0.000009   
18        0               0               1          0.000009   
19        1               0               0          0.000009   
20        0               1               0          0.000009   

      weight_mcweight_normalise  weight_pileup  weight_jvt  \
entry                                                        
0               [1.3800496e-05]       1.040258    0.966197   
1               [1.3800496e-05]       1.040258    0.994103   
2               [1.3800496e-05]       1.183654    0.977157   
3               [1.3800496e-05]       0.651527    0.982953   
4               [1.3800496e-05]       1.032648    0.994103   
5               [1.3800496e-05]       1.008581    1.000000   
6               [1.3800496e-05]       0.742007    0.943627   
7               [1.3800496e-05]       0.985139    1.000000   
8               [1.3800496e-05]       1.100541    0.989936   
9               [1.3800496e-05]       1.020371    0.994103   
10              [1.3800496e-05]       1.033192    1.000000   
11              [1.3800496e-05]       1.100541    0.982953   
12               [8.696023e-06]       0.835885    0.984098   
13               [8.696023e-06]       0.878693    0.924875   
14               [8.696023e-06]       1.020371    0.988241   
15               [8.696023e-06]       1.116819    0.977157   
16               [8.696023e-06]       1.008581    0.982413   
17               [8.696023e-06]       1.033192    0.968623   
18               [8.696023e-06]       1.189838    0.988241   
19               [8.696023e-06]       0.001000    0.952111   
20               [8.696023e-06]       1.020371    0.977157   

      mc_generator_weights  weight_bTagSF_MV2c10_Continuous_CDI20190730  \
entry                                                                     
0                    [1.0]                                     0.959040   
1                    [1.0]                                     1.053800   
2                    [1.0]                                     1.076922   
3                    [1.0]                                     1.015300   
4                    [1.0]                                     0.952200   
5                    [1.0]                                     0.816600   
6                    [1.0]                                     0.949346   
7                    [1.0]                                     0.960000   
8                    [1.0]                                     0.955044   
9                    [1.0]                                     0.952200   
10                   [1.0]                                     1.078000   
11                   [1.0]                                     1.218800   
12                   [1.0]                                     1.030568   
13                   [1.0]                                     0.947552   
14                   [1.0]                                     0.955044   
15                   [1.0]                                     0.979605   
16                   [1.0]                                     0.988021   
17                   [1.0]                                     1.218800   
18                   [1.0]                                     0.951248   
19                   [1.0]                                     0.942202   
20                   [1.0]                                     0.989010   

       weight_indiv_SF_EL_ChargeID  weight_mc  weight_leptonSF  isSignalBkg  \
entry                                                                         
0                         0.999450        1.0         0.964671          0.0   
1                         1.000270        1.0         0.941634          0.0   
2                         1.006971        1.0         0.941928          0.0   
3                         1.002110        1.0         0.882376          0.0   
4                         1.000000        1.0         0.966403          0.0   
5                         0.997060        1.0         0.967876          0.0   
6                         1.001870        1.0         0.950448          0.0   
7                         1.002010        1.0         0.968685          0.0   
8                         1.004410        1.0         0.952443          0.0   
9                         1.000000        1.0         0.978094          0.0   
10                        0.992739        1.0         0.919115          0.0   
11                        1.000110        1.0         0.929638          0.0   
12                        0.999790        1.0         0.959045          0.0   
13                        1.000830        1.0         0.936170          0.0   
14                        1.000000        1.0         0.977185          0.0   
15                        1.000830        1.0         0.967754          0.0   
16                        1.002160        1.0         0.978807          0.0   
17                        0.999450        1.0         0.971939          0.0   
18                        1.002100        1.0         0.928446          0.0   
19                        1.000000        1.0         0.990340          0.0   
20                        1.002810        1.0         0.979786          0.0   

             met_met         HT_all  deltaR_ll_sum  deltaR_ll_min  \
entry                                                               
0       74186.578125  173451.546875       0.400867       0.400867   
1       36557.207031  141680.796875       1.575788       1.575788   
2       61294.617188  182865.125000       2.752374       2.752374   
3       25703.498047  122770.031250       2.233053       2.233053   
4       14651.169922  331648.281250       2.764009       2.764009   
5      144766.921875  772476.437500       3.161644       3.161644   
6       39578.253906  355300.687500       2.510466       2.510466   
7       63732.730469  183103.718750       2.871073       2.871073   
8      147425.531250  285612.000000       3.185472       3.185472   
9       31118.167969  288899.812500       2.514630       2.514630   
10      50776.828125  103528.226562       0.976394       0.976394   
11      40305.187500  170044.453125       3.099617       3.099617   
12      35688.011719  168093.406250       2.624021       2.624021   
13       3404.940674  374887.312500       4.392360       0.575382   
14      37120.355469  317001.093750       4.522669       1.014232   
15      67258.757812  253466.375000       4.895865       1.174553   
16      32200.925781  346207.500000       2.951761       2.951761   
17      30575.998047  136152.234375       7.825338       2.508261   
18      54279.691406  340581.656250       3.551888       3.551888   
19      27212.130859  186420.250000       2.602618       2.602618   
20      31645.402344  297974.625000       2.633357       2.633357   

       SphericityJets  SphericityXYJets  runNumber  mcChannelNumber  \
entry                                                                 
0        5.555992e-01      6.548822e-02     284500           342284   
1        2.932404e-09      3.602117e-09     284500           342284   
2        2.500652e-01      1.646751e-01     284500           342284   
3        9.312350e-08      0.000000e+00     284500           342284   
4        5.792961e-08      4.308819e-08     284500           342284   
5       -3.451195e-09      0.000000e+00     284500           342284   
6        6.630414e-01      8.663917e-01     284500           342284   
7       -7.222606e-08      4.427803e-08     284500           342284   
8        1.456086e-02      1.091781e-01     284500           342284   
9       -4.516754e-08     -1.072281e-08     284500           342284   
10       1.113969e-08      0.000000e+00     284500           342284   
11       1.331109e-09      2.324247e-10     284500           342284   
12       4.664220e-01      5.765725e-01     284500           342285   
13       2.252924e-01      2.183652e-01     284500           342285   
14       8.033020e-02      3.899547e-01     284500           342285   
15       2.608316e-01      4.143496e-01     284500           342285   
16       1.702753e-01      4.281419e-02     284500           342285   
17      -1.110951e-09      0.000000e+00     284500           342285   
18       1.438134e-01      2.408370e-01     284500           342285   
19       4.599734e-02      8.743482e-01     284500           342285   
20       1.130502e-02      2.307921e-01     284500           342285   

       eventNumber        weight   mH  
entry                                  
0            11189  3.341745e-06  800  
1            21261  3.690793e-06  700  
2            22784  4.248130e-06  500  
3            20781  2.067373e-06  700  
4            34019  3.396720e-06  400  
5            44801  2.857926e-06  600  
6            53787  2.275948e-06  500  
7            75678  3.300751e-06  500  
8            83561  3.579122e-06  700  
9            90235  3.396939e-06  700  
10           99431  3.654217e-06  900  
11           36911  4.407808e-06  800  
12           15333  1.841727e-06  600  
13           26871  1.633403e-06  800  
14           25366  2.132242e-06  500  
15           78823  2.344112e-06  800  
16           80141  2.175810e-06  700  
17           51118  2.686104e-06  700  
18           96355  2.357913e-06  900  
19           12052  2.013606e-09  600  
20           85423  2.195272e-06  800  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Presel_df</span><span class="o">.</span><span class="n">mH</span><span class="p">[</span><span class="n">Presel_df</span><span class="o">.</span><span class="n">isSignalBkg</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span>
         <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;midnightblue&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Presel_df</span><span class="o">.</span><span class="n">mH</span><span class="p">[</span><span class="n">Presel_df</span><span class="o">.</span><span class="n">isSignalBkg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span>
         <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;background&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;mH [GeV]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Events&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;mH [GeV]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>